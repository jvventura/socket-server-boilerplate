{"version":3,"sources":["../../src/app/index.js"],"names":["App","connections","jackrabbit","process","env","CLOUDAMQP_URL","mongoose","MONGODB_URI","on","_onConnected","bind","self","queue","create","prefetch","_onReady","emit","log","data","publish","handle","job","ack","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;kBAsDe,YAAW;AACzB,QAAO,IAAIA,GAAJ,EAAP;AACA,C;;AAxDD;;;;AAEA;;;;AACA;;;;;;IAEMA,G;;;AACL,gBAAc;AAAA;;AAAA;;AAGb,QAAKC,WAAL,GAAmB,yBAAY;AAC9BC,eAAYC,QAAQC,GAAR,CAAYC,aADM;AAE9BC,aAAUH,QAAQC,GAAR,CAAYG;AAFQ,GAAZ,CAAnB;;AAKA,QAAKN,WAAL,CAAiBO,EAAjB,CAAoB,OAApB,EAA6B,MAAKC,YAAL,CAAkBC,IAAlB,OAA7B;AARa;AASb;;AAED;;;;iCAEe;AACd;;;AAGA,OAAIC,OAAO,IAAX;;AAEA,QAAKV,WAAL,CAAiBW,KAAjB,CAAuBC,MAAvB,CAA8B,YAA9B,EAA4C,EAAEC,UAAU,CAAZ,EAA5C,EAA6D,YAAM;AAClEH,SAAKI,QAAL;AACA,IAFD;AAGA;;;6BAEU;AACV,QAAKC,IAAL,CAAU,OAAV;AACA,oBAAOC,GAAP,CAAW,MAAX,EAAmB,aAAnB;AACA;;;4BAES;AACT,QAAKD,IAAL,CAAU,MAAV;AACA,oBAAOC,GAAP,CAAW,MAAX,EAAmB,oBAAnB;AACA;;AAED;AACC;;;;wBAEKC,I,EAAM;AACX,QAAKjB,WAAL,CAAiBW,KAAjB,CAAuBO,OAAvB,CAA+B,YAA/B,EAA6CD,IAA7C;AACA;;;4BAES;AACT,QAAKjB,WAAL,CAAiBmB,MAAjB,CAAwB,YAAxB,EAAsC,UAACC,GAAD,EAAMC,GAAN,EAAc;AACnD,qBAAOL,GAAP,CAAW,MAAX,EAAmBI,GAAnB;AACA,IAFD;AAGA;;;EA9CgB,iBAAOE,Y","file":"index.js","sourcesContent":["import events from 'events';\n\nimport connections from './connector';\nimport logger from '../modules/logger';\n\nclass App extends events.EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.connections = connections({\n\t\t\tjackrabbit: process.env.CLOUDAMQP_URL,\n\t\t\tmongoose: process.env.MONGODB_URI\n\t\t});\n\n\t\tthis.connections.on('ready', this._onConnected.bind(this));\n\t}\n\n\t// 'Private' methods.\n\n\t_onConnected() {\n\t\t/*\n\t\tthis.Events = this.connections.db; // instantiate schema (or connection to whatever db);\n\t\t*/\n\t\tlet self = this;\n\n\t\tthis.connections.queue.create('jobs.event', { prefetch: 5 }, () => {\n\t\t\tself._onReady();\n\t\t});\n\t}\n\n\t_onReady() {\n\t\tthis.emit('ready');\n\t\tlogger.log('info', 'App: Ready!')\n\t}\n\n\t_onLost() {\n\t\tthis.emit('lost');\n\t\tlogger.log('info', 'App: Disconnected.');\n\t}\n\n\t// 'Public' methods.\n\t\t// process event (pass msg data to queue for worker)\n\n\tqueue(data) {\n\t\tthis.connections.queue.publish('jobs.event', data);\n\t}\n\n\tprocess() {\n\t\tthis.connections.handle('jobs.event', (job, ack) => {\n\t\t\tlogger.log('info', job);\n\t\t});\n\t}\n}\n\nexport default function() {\n\treturn new App();\n}"]}