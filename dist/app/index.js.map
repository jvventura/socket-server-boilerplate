{"version":3,"sources":["../../src/app/index.js"],"names":["App","connections","jackrabbit","process","env","CLOUDAMQP_URL","mongoose","MONGODB_URI","on","_onConnected","bind","self","log","queue","name","prefetch","durabe","connection","_onReady","emit","data","publish","handle","job","ack","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;kBA8De,YAAW;AACzB,QAAO,IAAIA,GAAJ,EAAP;AACA,C;;AAhED;;;;AAEA;;;;AACA;;;;;;IAEMA,G;;;AACL,gBAAc;AAAA;;AAAA;;AAGb,QAAKC,WAAL,GAAmB,yBAAY;AAC9BC,eAAYC,QAAQC,GAAR,CAAYC,aADM;AAE9BC,aAAUH,QAAQC,GAAR,CAAYG;AAFQ,GAAZ,CAAnB;;AAKA,QAAKN,WAAL,CAAiBO,EAAjB,CAAoB,OAApB,EAA6B,MAAKC,YAAL,CAAkBC,IAAlB,OAA7B;AARa;AASb;;AAED;;;;iCAEe;AACd;;;AAGA,OAAIC,OAAO,IAAX;;AAEA,oBAAOC,GAAP,CAAW,MAAX,EAAmB,KAAKX,WAAL,CAAiBY,KAApC;;AAEA,QAAKZ,WAAL,CAAiBY,KAAjB,CAAuBA,KAAvB,CAA6B;AAC5BC,UAAM,YADsB;AAE5BC,cAAU,CAFkB;AAG5BC,YAAQ;AAHoB,IAA7B;;AAMA,QAAKC,UAAL,CAAgBJ,KAAhB,CAAsBA,KAAtB,CAA4BL,EAA5B,CAA+B,OAA/B,EAAwC,YAAM;AAC7CG,SAAKO,QAAL;AACA,IAFD;AAGA;;;6BAEU;AACV,QAAKC,IAAL,CAAU,OAAV;AACA,oBAAOP,GAAP,CAAW,MAAX,EAAmB,aAAnB;AACA;;;4BAES;AACT,QAAKO,IAAL,CAAU,MAAV;AACA,oBAAOP,GAAP,CAAW,MAAX,EAAmB,oBAAnB;AACA;;AAED;AACC;;;;wBAEKQ,I,EAAM;AACX,QAAKnB,WAAL,CAAiBY,KAAjB,CAAuBQ,OAAvB,CAA+B,YAA/B,EAA6CD,IAA7C;AACA;;;4BAES;AACT,QAAKnB,WAAL,CAAiBqB,MAAjB,CAAwB,YAAxB,EAAsC,UAACC,GAAD,EAAMC,GAAN,EAAc;AACnD,qBAAOZ,GAAP,CAAW,MAAX,EAAmBW,GAAnB;AACA,IAFD;AAGA;;;EAtDgB,iBAAOE,Y","file":"index.js","sourcesContent":["import events from 'events';\n\nimport connections from './connector';\nimport logger from '../modules/logger';\n\nclass App extends events.EventEmitter {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.connections = connections({\n\t\t\tjackrabbit: process.env.CLOUDAMQP_URL,\n\t\t\tmongoose: process.env.MONGODB_URI\n\t\t});\n\n\t\tthis.connections.on('ready', this._onConnected.bind(this));\n\t}\n\n\t// 'Private' methods.\n\n\t_onConnected() {\n\t\t/*\n\t\tthis.Events = this.connections.db; // instantiate schema (or connection to whatever db);\n\t\t*/\n\t\tlet self = this;\n\n\t\tlogger.log('info', this.connections.queue);\n\n\t\tthis.connections.queue.queue({\n\t\t\tname: 'jobs.event',\n\t\t\tprefetch: 5,\n\t\t\tdurabe: true\n\t\t});\n\n\t\tthis.connection.queue.queue.on('ready', () => {\n\t\t\tself._onReady();\n\t\t});\n\t}\n\n\t_onReady() {\n\t\tthis.emit('ready');\n\t\tlogger.log('info', 'App: Ready!')\n\t}\n\n\t_onLost() {\n\t\tthis.emit('lost');\n\t\tlogger.log('info', 'App: Disconnected.');\n\t}\n\n\t// 'Public' methods.\n\t\t// process event (pass msg data to queue for worker)\n\n\tqueue(data) {\n\t\tthis.connections.queue.publish('jobs.event', data);\n\t}\n\n\tprocess() {\n\t\tthis.connections.handle('jobs.event', (job, ack) => {\n\t\t\tlogger.log('info', job);\n\t\t});\n\t}\n}\n\nexport default function() {\n\treturn new App();\n}"]}