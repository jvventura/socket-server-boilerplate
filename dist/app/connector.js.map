{"version":3,"sources":["../../src/app/connector.js"],"names":["urls","Connector","count","db","mongoose","queue","jackrabbit","emit","self","connect","connection","on","log","_ready","err","rabbit","_lost","default","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;kBAuEe,UAASA,IAAT,EAAe;AAC7B,QAAO,IAAIC,SAAJ,CAAcD,IAAd,CAAP;AACA,C;;AAzED;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;;;IAEMC,S;;;AACL,oBAAYD,IAAZ,EAAkB;AAAA;;AAAA;;AAEjB,QAAKE,KAAL,GAAa,CAAb;AACA,QAAKF,IAAL,GAAYA,QAAQ,EAApB;;AAEA,QAAKG,EAAL,GAAU,MAAKC,QAAL,EAAV;AACA,QAAKC,KAAL,GAAa,MAAKC,UAAL,EAAb;AANiB;AAOjB;;AAGD;;;;2BAES;AACR;AACA,OAAI,EAAE,KAAKJ,KAAP,IAAgB,CAApB,EAAuB;AACtB,SAAKK,IAAL,CAAU,OAAV;AACA;AACD;;;0BAEO;AACP;AACA,QAAKA,IAAL,CAAU,MAAV;AACA;;AAED;;;;6BAEW;AACV,OAAIC,OAAO,IAAX;;AAEA,sBAASC,OAAT,CAAiB,KAAKT,IAAL,CAAUI,QAA3B;;AAEA,sBAASM,UAAT,CAAoBC,EAApB,CAAuB,WAAvB,EAAoC,YAAM;AACzC,qBAAOC,GAAP,CAAW,MAAX,EAAmB,gCAAnB;AACAJ,SAAKK,MAAL;AACA,IAHD;AAIA,sBAASH,UAAT,CAAoBC,EAApB,CAAuB,OAAvB,EAAgC,eAAO;AACtC,qBAAOC,GAAP,CAAW,OAAX,EAAoBE,GAApB;AACA,IAFD;AAGA,sBAASJ,UAAT,CAAoBC,EAApB,CAAuB,cAAvB,EAAuC,YAAM;AAC5C,qBAAOC,GAAP,CAAW,MAAX,EAAmB,mCAAnB;AACA,IAFD;AAGA;;;+BAEY;AACZ,OAAIJ,OAAO,IAAX;;AAEA,OAAIO,SAAS,0BAAW,KAAKf,IAAL,CAAUM,UAArB,CAAb;AACAS,UAAOJ,EAAP,CAAU,WAAV,EAAuB,YAAM;AAC5B,qBAAOC,GAAP,CAAW,MAAX,EAAmB,kCAAnB;AACAJ,SAAKK,MAAL;AACA,IAHD;AAIAE,UAAOJ,EAAP,CAAU,OAAV,EAAmB,eAAO;AACzB,qBAAOC,GAAP,CAAW,OAAX,EAAoBE,GAApB;AACA,IAFD;AAGAC,UAAOJ,EAAP,CAAU,cAAV,EAA0B,YAAM;AAC/B,qBAAOC,GAAP,CAAW,MAAX,EAAmB,qCAAnB;AACAJ,SAAKQ,KAAL;AACA,IAHD;AAIA,UAAOD,OAAOE,OAAP,EAAP;AACA;;;EA5DsB,iBAAOC,Y","file":"connector.js","sourcesContent":["import events from 'events';\r\nimport jackrabbit from 'jackrabbit';\r\nimport mongoose from 'mongoose';\r\nimport DynamoDB from 'aws-sdk/clients/dynamodb';\r\n\r\nimport logger from '../modules/logger';\r\n\r\nclass Connector extends events.EventEmitter {\r\n\tconstructor(urls) {\r\n\t\tsuper();\r\n\t\tthis.count = 2;\r\n\t\tthis.urls = urls || {};\r\n\r\n\t\tthis.db = this.mongoose();\r\n\t\tthis.queue = this.jackrabbit();\r\n\t}\r\n\r\n\r\n\t// 'Private' methods.\r\n\r\n\t_ready() {\r\n\t\t// Connection ready!\r\n\t\tif (--this.count == 0) {\r\n\t\t\tthis.emit('ready');\r\n\t\t}\r\n\t}\r\n\r\n\t_lost() {\r\n\t\t// Connection lost!\r\n\t\tthis.emit('lost');\r\n\t}\r\n\r\n\t// 'Public' methods.\r\n\r\n\tmongoose() {\r\n\t\tlet self = this;\r\n\r\n\t\tmongoose.connect(this.urls.mongoose);\r\n\r\n\t\tmongoose.connection.on('connected', () => {  \r\n\t\t\tlogger.log('info', 'Connector: Mongoose connected.');\r\n\t\t\tself._ready();\r\n\t\t});\r\n\t\tmongoose.connection.on('error', err => {\r\n\t\t\tlogger.log('error', err);\r\n\t\t});\r\n\t\tmongoose.connection.on('disconnected', () => {\r\n\t\t\tlogger.log('info', 'Connector: Mongoose disconnected.');\r\n\t\t});\r\n\t}\r\n\r\n\tjackrabbit() {\r\n\t\tlet self = this;\r\n\r\n\t\tlet rabbit = jackrabbit(this.urls.jackrabbit);\r\n\t\trabbit.on('connected', () => {\r\n\t\t\tlogger.log('info', 'Connector: Jackrabbit connected.');\r\n\t\t\tself._ready();\r\n\t\t})\r\n\t\trabbit.on('error', err => {\r\n\t\t\tlogger.log('error', err);\r\n\t\t})\r\n\t\trabbit.on('disconnected', () => {\r\n\t\t\tlogger.log('info', 'Connector: Jackrabbit disconnected.');\r\n\t\t\tself._lost();\r\n\t\t});\r\n\t\treturn rabbit.default();\r\n\t}\r\n\r\n}\r\n\r\nexport default function(urls) {\r\n\treturn new Connector(urls);\r\n}"]}