{"version":3,"sources":["../../src/app/connector.js"],"names":["urls","Connector","count","db","mongoose","queue","jackrabbit","emit","self","connect","connection","on","log","_ready","err","rabbit","_lost","default","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;kBAuEe,UAASA,IAAT,EAAe;AAC7B,QAAO,IAAIC,SAAJ,CAAcD,IAAd,CAAP;AACA,C;;AAzED;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;;;IAEMC,S;;;AACL,oBAAYD,IAAZ,EAAkB;AAAA;;AAAA;;AAEjB,QAAKE,KAAL,GAAa,CAAb;AACA,QAAKF,IAAL,GAAYA,QAAQ,EAApB;;AAEA,QAAKG,EAAL,GAAU,MAAKC,QAAL,EAAV;AACA,QAAKC,KAAL,GAAa,MAAKC,UAAL,EAAb;AANiB;AAOjB;;AAGD;;;;2BAES;AACR;AACA,OAAI,EAAE,KAAKJ,KAAP,IAAgB,CAApB,EAAuB;AACtB,SAAKK,IAAL,CAAU,OAAV;AACA;AACD;;;0BAEO;AACP;AACA,QAAKA,IAAL,CAAU,MAAV;AACA;;AAED;;;;6BAEW;AACV,OAAIC,OAAO,IAAX;;AAEA,sBAASC,OAAT,CAAiB,KAAKT,IAAL,CAAUI,QAA3B;;AAEA,sBAASM,UAAT,CAAoBC,EAApB,CAAuB,WAAvB,EAAoC,YAAM;AACzC,qBAAOC,GAAP,CAAW,MAAX,EAAmB,gCAAnB;AACAJ,SAAKK,MAAL;AACA,IAHD;AAIA,sBAASH,UAAT,CAAoBC,EAApB,CAAuB,OAAvB,EAAgC,eAAO;AACtC,qBAAOC,GAAP,CAAW,OAAX,EAAoBE,GAApB;AACA,IAFD;AAGA,sBAASJ,UAAT,CAAoBC,EAApB,CAAuB,cAAvB,EAAuC,YAAM;AAC5C,qBAAOC,GAAP,CAAW,MAAX,EAAmB,mCAAnB;AACA,IAFD;AAGA;;;+BAEY;AACZ,OAAIJ,OAAO,IAAX;;AAEA,OAAIO,SAAS,0BAAW,KAAKf,IAAL,CAAUM,UAArB,CAAb;AACAS,UAAOJ,EAAP,CAAU,WAAV,EAAuB,YAAM;AAC5B,qBAAOC,GAAP,CAAW,MAAX,EAAmB,kCAAnB;AACAJ,SAAKK,MAAL;AACA,IAHD;AAIAE,UAAOJ,EAAP,CAAU,OAAV,EAAmB,eAAO;AACzB,qBAAOC,GAAP,CAAW,OAAX,EAAoBE,GAApB;AACA,IAFD;AAGAC,UAAOJ,EAAP,CAAU,cAAV,EAA0B,YAAM;AAC/B,qBAAOC,GAAP,CAAW,MAAX,EAAmB,qCAAnB;AACAJ,SAAKQ,KAAL;AACA,IAHD;AAIA,UAAOD,OAAOE,OAAP,EAAP;AACA;;;EA5DsB,iBAAOC,Y","file":"connector.js","sourcesContent":["import events from 'events';\nimport jackrabbit from 'jackrabbit';\nimport mongoose from 'mongoose';\nimport DynamoDB from 'aws-sdk/clients/dynamodb';\n\nimport logger from '../modules/logger';\n\nclass Connector extends events.EventEmitter {\n\tconstructor(urls) {\n\t\tsuper();\n\t\tthis.count = 2;\n\t\tthis.urls = urls || {};\n\n\t\tthis.db = this.mongoose();\n\t\tthis.queue = this.jackrabbit();\n\t}\n\n\n\t// 'Private' methods.\n\n\t_ready() {\n\t\t// Connection ready!\n\t\tif (--this.count == 0) {\n\t\t\tthis.emit('ready');\n\t\t}\n\t}\n\n\t_lost() {\n\t\t// Connection lost!\n\t\tthis.emit('lost');\n\t}\n\n\t// 'Public' methods.\n\n\tmongoose() {\n\t\tlet self = this;\n\n\t\tmongoose.connect(this.urls.mongoose);\n\n\t\tmongoose.connection.on('connected', () => {  \n\t\t\tlogger.log('info', 'Connector: Mongoose connected.');\n\t\t\tself._ready();\n\t\t});\n\t\tmongoose.connection.on('error', err => {\n\t\t\tlogger.log('error', err);\n\t\t});\n\t\tmongoose.connection.on('disconnected', () => {\n\t\t\tlogger.log('info', 'Connector: Mongoose disconnected.');\n\t\t});\n\t}\n\n\tjackrabbit() {\n\t\tlet self = this;\n\n\t\tlet rabbit = jackrabbit(this.urls.jackrabbit);\n\t\trabbit.on('connected', () => {\n\t\t\tlogger.log('info', 'Connector: Jackrabbit connected.');\n\t\t\tself._ready();\n\t\t})\n\t\trabbit.on('error', err => {\n\t\t\tlogger.log('error', err);\n\t\t})\n\t\trabbit.on('disconnected', () => {\n\t\t\tlogger.log('info', 'Connector: Jackrabbit disconnected.');\n\t\t\tself._lost();\n\t\t});\n\t\treturn rabbit.default();\n\t}\n\n}\n\nexport default function(urls) {\n\treturn new Connector(urls);\n}"]}