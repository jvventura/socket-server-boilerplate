{"version":3,"sources":["../../src/app/connector.js"],"names":["urls","Connector","count","emit","self","connect","mongoose","on","log","_ready","err","jackrabbit","_lost","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;kBAiEe,UAASA,IAAT,EAAe;AAC7B,QAAO,IAAIC,SAAJ,CAAcD,IAAd,CAAP;AACA,C;;AAnED;;;;AACA;;;;AACA;;;;AAEA;;;;;;IAEMC,S;;;AACL,oBAAYD,IAAZ,EAAkB;AAAA;;AAAA;;AAEjB,QAAKE,KAAL,GAAa,CAAb;AACA,QAAKF,IAAL,GAAYA,QAAQ,EAApB;AAHiB;AAIjB;;AAGD;;;;2BAES;AACR;AACA,OAAI,EAAE,KAAKE,KAAX,EAAkB;AACjB,SAAKC,IAAL,CAAU,OAAV;AACA;AACD;;;0BAEO;AACP;AACA,QAAKA,IAAL,CAAU,MAAV;AACA;;AAED;;;;uBAEK;AACJ,OAAIC,OAAO,IAAX;;AAEA,UAAO,mBAASC,OAAT,CAAiB,KAAKL,IAAL,CAAUM,QAA3B,EACNC,EADM,CACH,WADG,EACU,YAAM;AACtB,qBAAOC,GAAP,CAAW,MAAX,EAAmB,gCAAnB;AACAJ,SAAKK,MAAL;AACA,IAJM,EAKNF,EALM,CAKH,OALG,EAKM,eAAO;AACnB,qBAAOC,GAAP,CAAW,OAAX,EAAoBE,GAApB;AACA,IAPM,EAQNH,EARM,CAQH,cARG,EAQa,YAAM;AACzB,qBAAOC,GAAP,CAAW,MAAX,EAAmB,mCAAnB;AACA,IAVM,CAAP;AAWA;;;0BAEO;AACP,OAAIJ,OAAO,IAAX;;AAEA,UAAO,0BAAW,KAAKJ,IAAL,CAAUW,UAArB,EACNJ,EADM,CACH,WADG,EACU,YAAM;AACtB,qBAAOC,GAAP,CAAW,MAAX,EAAmB,kCAAnB;AACAJ,SAAKK,MAAL;AACA,IAJM,EAKNF,EALM,CAKH,OALG,EAKM,eAAO;AACnB,qBAAOC,GAAP,CAAW,OAAX,EAAoBE,GAApB;AACA,IAPM,EAQNH,EARM,CAQH,cARG,EAQa,YAAM;AACzB,qBAAOC,GAAP,CAAW,MAAX,EAAmB,qCAAnB;AACAJ,SAAKQ,KAAL;AACA,IAXM,CAAP;AAYA;;;EAvDsB,iBAAOC,Y","file":"connector.js","sourcesContent":["import events from 'events';\nimport jackrabbit from 'jackrabbit';\nimport mongoose from 'mongoose';\n\nimport logger from '../modules/logger';\n\nclass Connector extends events.EventEmitter {\n\tconstructor(urls) {\n\t\tsuper();\n\t\tthis.count = 2;\n\t\tthis.urls = urls || {};\n\t}\n\n\n\t// 'Private' methods.\n\n\t_ready() {\n\t\t// Connection ready!\n\t\tif (--this.count) {\n\t\t\tthis.emit('ready');\n\t\t}\n\t}\n\n\t_lost() {\n\t\t// Connection lost!\n\t\tthis.emit('lost');\n\t}\n\n\t// 'Public' methods.\n\n\tdb() {\n\t\tlet self = this;\n\n\t\treturn mongoose.connect(this.urls.mongoose)\n\t\t.on('connected', () => {  \n\t\t\tlogger.log('info', 'Connector: Mongoose connected.');\n\t\t\tself._ready();\n\t\t})\n\t\t.on('error', err => {\n\t\t\tlogger.log('error', err);\n\t\t})\n\t\t.on('disconnected', () => {\n\t\t\tlogger.log('info', 'Connector: Mongoose disconnected.');\n\t\t})\n\t}\n\n\tqueue() {\n\t\tlet self = this;\n\n\t\treturn jackrabbit(this.urls.jackrabbit)\n\t\t.on('connected', () => {\n\t\t\tlogger.log('info', 'Connector: Jackrabbit connected.');\n\t\t\tself._ready();\n\t\t})\n\t\t.on('error', err => {\n\t\t\tlogger.log('error', err);\n\t\t})\n\t\t.on('disconnected', () => {\n\t\t\tlogger.log('info', 'Connector: Jackrabbit disconnected.');\n\t\t\tself._lost();\n\t\t});\n\t}\n\n}\n\nexport default function(urls) {\n\treturn new Connector(urls);\n}"]}