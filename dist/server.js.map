{"version":3,"sources":["../src/server.js"],"names":["globalAgent","maxSockets","Infinity","workers","start","log","instance","on","createServer","abort","process","env","THRIFTY","server","shutdown","removeListener","close","exit"],"mappings":";;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;AAEA;;;;;;AAEA,eAAKA,WAAL,CAAiBC,UAAjB,GAA8BC,QAA9B;AACA,sBAAO,EAAEC,SAAS,CAAX,EAAP,EAAuBC,KAAvB;;AAEA,SAASA,KAAT,GAAiB;AAChB,kBAAOC,GAAP,CAAW,MAAX,EAAmB,gCAAnB;;AAEA,KAAIC,WAAW,oBAAf;;AAEAA,UAASC,EAAT,CAAY,OAAZ,EAAqBC,YAArB;AACAF,UAASC,EAAT,CAAY,MAAZ,EAAoBE,KAApB;;AAEA,UAASD,YAAT,GAAwB;AACvB;AACA,MAAIE,QAAQC,GAAR,CAAYC,OAAhB,EAAyBN,SAASI,OAAT;;AAEzB,MAAIG,SAAS,mBAAIP,QAAJ,CAAb;AACAI,UAAQH,EAAR,CAAW,SAAX,EAAsBO,QAAtB;AACAR,WACCS,cADD,CACgB,MADhB,EACwBN,KADxB,EAECF,EAFD,CAEI,MAFJ,EAEYO,QAFZ;;AAIA,WAASA,QAAT,GAAoB;AACnB,oBAAOT,GAAP,CAAW,MAAX,EAAmB,uBAAnB;AACAQ,UAAOG,KAAP,CAAa,YAAW;AACvB,qBAAOX,GAAP,CAAW,MAAX,EAAmB,kBAAnB;AACAK,YAAQO,IAAR;AACA,IAHD;AAIA;AACD;;AAED,UAASR,KAAT,GAAiB;AAChB,mBAAOJ,GAAP,CAAW,MAAX,EAAmB,eAAnB;AACAK,UAAQO,IAAR;AACA;AACD","file":"server.js","sourcesContent":["import http from 'http';\r\nimport throng from 'throng';\r\n\r\nimport App from './app';\r\nimport Web from './web';\r\n\r\nimport logger from './modules/logger';\r\n\r\nhttp.globalAgent.maxSockets = Infinity;\r\nthrong({ workers: 1 }, start);\r\n\r\nfunction start() {\r\n\tlogger.log('info', 'Attempting to starting server.');\r\n\r\n\tlet instance = App();\r\n\r\n\tinstance.on('ready', createServer);\r\n\tinstance.on('lost', abort);\r\n\r\n\tfunction createServer() {\r\n\t\t// If THRIFTY mode, process will act as both publisher and consumer.\r\n\t\tif (process.env.THRIFTY) instance.process();\r\n\r\n\t\tlet server = Web(instance);\r\n\t\tprocess.on('SIGTERM', shutdown);\r\n\t\tinstance\r\n\t\t.removeListener('lost', abort)\r\n\t\t.on('lost', shutdown);\r\n\r\n\t\tfunction shutdown() {\r\n\t\t\tlogger.log('info', 'Server shutting down.');\r\n\t\t\tserver.close(function() {\r\n\t\t\t\tlogger.log('info', 'Server shutdown.');\r\n\t\t\t\tprocess.exit();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction abort() {\r\n\t\tlogger.log('info', 'Server abort.');\r\n\t\tprocess.exit();\r\n\t}\r\n}"]}