{"version":3,"sources":["../src/server.js"],"names":["globalAgent","maxSockets","Infinity","start","log","instance","on","createServer","abort","process","env","THRIFTY","server","shutdown","removeListener","close","exit"],"mappings":";;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;AAEA;;;;;;AAEA,eAAKA,WAAL,CAAiBC,UAAjB,GAA8BC,QAA9B;AACA,sBAAOC,KAAP;;AAEA,SAASA,KAAT,GAAiB;AAChB,kBAAOC,GAAP,CAAW,MAAX,EAAmB,gCAAnB;;AAEA,KAAIC,WAAW,oBAAf;;AAEAA,UAASC,EAAT,CAAY,OAAZ,EAAqBC,YAArB;AACAF,UAASC,EAAT,CAAY,MAAZ,EAAoBE,KAApB;;AAEA,UAASD,YAAT,GAAwB;AACvB;AACA,MAAIE,QAAQC,GAAR,CAAYC,OAAhB,EAAyBN,SAASI,OAAT;;AAEzB,MAAIG,SAAS,mBAAIP,QAAJ,CAAb;AACAI,UAAQH,EAAR,CAAW,SAAX,EAAsBO,QAAtB;AACAR,WACCS,cADD,CACgB,MADhB,EACwBN,KADxB,EAECF,EAFD,CAEI,MAFJ,EAEYO,QAFZ;;AAIA,WAASA,QAAT,GAAoB;AACnB,oBAAOT,GAAP,CAAW,MAAX,EAAmB,uBAAnB;AACAQ,UAAOG,KAAP,CAAa,YAAW;AACvB,qBAAOX,GAAP,CAAW,MAAX,EAAmB,kBAAnB;AACAK,YAAQO,IAAR;AACA,IAHD;AAIA;AACD;;AAED,UAASR,KAAT,GAAiB;AAChB,mBAAOJ,GAAP,CAAW,MAAX,EAAmB,eAAnB;AACAK,UAAQO,IAAR;AACA;AACD","file":"server.js","sourcesContent":["import http from 'http';\nimport throng from 'throng';\n\nimport App from './app';\nimport Web from './web';\n\nimport logger from './modules/logger';\n\nhttp.globalAgent.maxSockets = Infinity;\nthrong(start);\n\nfunction start() {\n\tlogger.log('info', 'Attempting to starting server.');\n\n\tlet instance = App();\n\n\tinstance.on('ready', createServer);\n\tinstance.on('lost', abort);\n\n\tfunction createServer() {\n\t\t// If THRIFTY mode, process will act as both publisher and consumer.\n\t\tif (process.env.THRIFTY) instance.process();\n\n\t\tlet server = Web(instance);\n\t\tprocess.on('SIGTERM', shutdown);\n\t\tinstance\n\t\t.removeListener('lost', abort)\n\t\t.on('lost', shutdown);\n\n\t\tfunction shutdown() {\n\t\t\tlogger.log('info', 'Server shutting down.');\n\t\t\tserver.close(function() {\n\t\t\t\tlogger.log('info', 'Server shutdown.');\n\t\t\t\tprocess.exit();\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction abort() {\n\t\tlogger.log('info', 'Server abort.');\n\t\tprocess.exit();\n\t}\n}"]}