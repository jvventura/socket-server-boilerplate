{"version":3,"sources":["../../src/web/index.js"],"names":["Web","app","web","server","createServer","io","session","process","env","REDISCLOUD_URL","use","autoSave","on","queue","event","setInterval","port","PORT","listen","log","address"],"mappings":";;;;;;AAAA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;;;AAEA,SAASA,GAAT,CAAaC,GAAb,EAAkB;AACjB;AACA,KAAIC,MAAM,wBAAV;AACA,KAAIC,SAAS,eAAKC,YAAL,CAAkBF,GAAlB,CAAb;AACA,KAAIG,KAAK,sBAASF,MAAT,CAAT;;AAEA;AACA,KAAIG,UAAU,wBAASC,QAAQC,GAAR,CAAYC,cAArB,CAAd;AACAP,KAAIQ,GAAJ,CAAQJ,OAAR;AACAJ,KAAIQ,GAAJ,CAAQ,6BAAR;AACAL,IAAGK,GAAH,CAAO,6BAAcJ,OAAd,EAAuB;AAC1BK,YAAS;AADiB,EAAvB,CAAP;;AAIAN,IAAGO,EAAH,CAAM,YAAN,EAAoB,kBAAU;AAC/B;;;;;;;;;;;;;;;;;;;;;;AAsBEX,MAAIY,KAAJ,CAAU,EAACC,OAAO,mBAAR,EAAV;AAEA,EAzBD;;AA2BAC,aAAY,YAAM;AACjBd,MAAIY,KAAJ,CAAU,EAACC,OAAO,UAAR,EAAV;AACA,EAFD,EAEG,IAFH;;AAIA;AACA,KAAIE,OAAOT,QAAQC,GAAR,CAAYS,IAAZ,IAAoB,IAA/B;AACAd,QAAOe,MAAP,CAAcF,IAAd,EAAoB,YAAM;AACzB,mBAAOG,GAAP,CAAW,MAAX,EAAmB,0BAAnB,EAA+ChB,OAAOiB,OAAP,GAAiBJ,IAAhE;AACA,EAFD;;AAIA,QAAOb,MAAP;AACA;;kBAEcH,G","file":"index.js","sourcesContent":["import http from 'http';\n\nimport express from 'express';\nimport socketio from 'socket.io';\nimport sharedSession from 'express-socket.io-session';\nimport cookieParser from 'cookie-parser';\n\nimport sessions from '../modules/sessions';\nimport logger from '../modules/logger';\n\nfunction Web(app) {\n\t// Instantiate server.\n\tlet web = express();\n\tlet server = http.createServer(web);\n\tlet io = socketio(server);\n\n\t// Connect to RedisStore for sessions.\n\tlet session = sessions(process.env.REDISCLOUD_URL);\n\tweb.use(session);\n\tweb.use(cookieParser());\n\tio.use(sharedSession(session, {\n\t    autoSave:true\n\t}));\n\n\tio.on('connection', socket => {\n/*\n\t\t// user data scheme:\n\t\t\t// user id, 'infinite' duration\n\t\t\t// session id, session duration\n\t\tsocket.on('connect', () => {\n\t\t\tif (!socket.handshake.session) {\n\t\t\t\tFunction.compose(checkUser, checkSession); // dunno if this will work\n\t\t\t\t// if no user id supplied, generate a new one\n\t\t\t\t// if no session is supplied, generate a new one\n\t\t\t}\n\t\t});\n\n\t\tsocket.on('message', data => {\n\t\t\t// double check user and session!\n\t\t\t// validate message\n\t\t\t// call App.queueData\n\t\t});\n\n\n\t\tfunction checkUser() {}\n\t\tfunction checkSession() {}\n*/\n\t\tapp.queue({event: 'socket_connection'});\n\n\t});\n\n\tsetInterval(() => {\n\t\tapp.queue({event: 'interval'});\n\t}, 5000);\n\n\t// Start server.\n\tlet port = process.env.PORT || 5000;\n\tserver.listen(port, () => {\n\t\tlogger.log('info', 'Server listening on port', server.address().port);\n\t});\n\n\treturn server;\n}\n\nexport default Web;\n"]}